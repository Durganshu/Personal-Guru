{% extends "base.html" %}

{% block title %}Reading: {{ book.title }} - Personal Guru{% endblock %}
{% block head %}
{{ super() }}
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Outfit:wght@400;700;800&display=swap" rel="stylesheet">
<style>
    .book-layout {
        display: flex;
        height: calc(100vh - 60px);
        background: var(--bg-color, #11111b);
    }
    .book-content {
        flex: 1;
        padding: 2rem;
        overflow-y: auto;
    }
    .notes-sidebar {
        width: var(--notes-sidebar-width, 350px);
        background: var(--surface-color, #1e1e2e);
        border-left: 1px solid var(--border-color, #313244);
        padding: 0;
        overflow-y: auto;
        transition: width 0.3s ease, padding 0.3s ease;
        position: relative;
        display: flex;
        flex-direction: column;
    }
    .notes-sidebar h4 {
        padding: 1rem 1rem 0 1rem;
        margin-bottom: 0;
    }
    .notes-sidebar hr {
        margin: 0.5rem 1rem 1rem 1rem;
    }
    .notes-sidebar.collapsed {
        width: 0 !important;
        padding: 0;
        overflow: hidden;
        border-left: none;
    }
    .resizer {
        position: absolute;
        left: -5px;
        top: 0;
        bottom: 0;
        width: 10px;
        cursor: col-resize;
        background: transparent;
        transition: background 0.2s;
        z-index: 100;
    }
    .resizer:hover, .resizer.resizing {
        background: rgba(137, 180, 250, 0.3); /* Distinct soft blue tint */
        border-left: 2px solid var(--primary-color);
    }
    .toc-sidebar {
        width: 300px;
        background: var(--surface-color, #1e1e2e);
        border-right: 1px solid var(--border-color, #313244);
        padding: 1.5rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        transition: width 0.3s ease, padding 0.3s ease;
    }
    .toc-sidebar.collapsed {
        width: 0;
        padding: 0;
        overflow: hidden;
        border-right: none;
    }
    .toc-item {
        padding: 0.5rem 0.5rem 0.5rem 1.5rem; /* Left padding for indentation */
        border-radius: 6px;
        color: var(--text-color, #cdd6f4);
        text-decoration: none;
        display: block;
        margin-bottom: 0.25rem;
        transition: background 0.2s;
        font-size: 0.9rem;
        position: relative;
    }
    .toc-item::before {
        content: '\f15c'; /* FontAwesome file-alt icon */
        font-family: 'Font Awesome 5 Free';
        font-weight: 400;
        position: absolute;
        left: 0.5rem;
        opacity: 0.5;
        font-size: 0.8rem;
        top: 0.65rem;
    }
    .toc-item:hover {
        background: rgba(255,255,255,0.05);
        color: var(--primary-color, #cba6f7);
    }
    .toc-item.active {
        background: var(--primary-color, #cba6f7);
        color: #11111b;
        font-weight: bold;
    }
    .toc-item.active::before {
        opacity: 1;
        color: #11111b;
    }
    .toc-topic {
        font-weight: bold;
        color: var(--subtext-color, #a6adc8);
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 1px;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .toc-topic i {
        color: var(--primary-color);
    }
    .book-header {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        margin-bottom: 2.5rem;
        padding: 1.5rem;
        background: rgba(30, 30, 46, 0.4);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        border: 1px solid var(--border-color);
    }
    .header-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 2rem;
    }
    .header-bottom {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 1rem;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    .book-title {
        font-family: 'Outfit', sans-serif;
        font-size: 2.2rem;
        font-weight: 800;
        background: linear-gradient(135deg, #fff 0%, #cba6f7 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        line-height: 1.1;
        margin-bottom: 0.5rem;
    }
    .page-nav {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        background: rgba(0,0,0,0.2);
        padding: 0.25rem;
        border-radius: 8px;
    }
    .nav-btn {
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 600;
        transition: all 0.2s;
    }
    .nav-stats {
        padding: 0 1rem;
        font-size: 0.85rem;
        color: var(--subtext-color);
        font-family: 'JetBrains Mono', monospace;
    }
    .topic-indicator {
        font-size: 0.75rem;
        color: var(--primary-color, #cba6f7);
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 0.5rem;
        opacity: 0.8;
    }
    /* Simple Premium Toggle Switch */
    .premium-switch {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        padding: 0.5rem 0.75rem;
        background: rgba(255,255,255,0.05);
        border-radius: 20px;
        transition: background 0.2s;
    }
    .premium-switch:hover {
        background: rgba(255,255,255,0.1);
    }
    .switch-label {
        font-size: 0.85rem;
        color: var(--subtext-color);
        user-select: none;
    }
    .switch-track {
        width: 36px;
        height: 20px;
        background: #313244;
        border-radius: 10px;
        position: relative;
        transition: background 0.3s;
    }
    .switch-track::after {
        content: '';
        width: 14px;
        height: 14px;
        background: #fff;
        border-radius: 50%;
        position: absolute;
        top: 3px;
        left: 3px;
        transition: transform 0.3s;
    }
    input:checked + .premium-switch .switch-track {
        background: var(--primary-color);
    }
    input:checked + .premium-switch .switch-track::after {
        transform: translateX(16px);
    }
    .toolbar {
        display: flex;
        gap: 0.75rem;
        align-items: center;
    }
    .note-block {
        background: rgba(255,255,255,0.05);
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        border-left: 3px solid var(--primary-color);
    }
    .book-footer {
        display: flex;
        justify-content: center;
        margin-top: 5rem;
        padding-top: 3rem;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        padding-bottom: 3rem;
    }
    .notes-editor {
        width: 100%;
        min-height: calc(100vh - 250px);
        background: transparent;
        border: none;
        color: var(--text-color);
        font-family: inherit;
        font-size: 1rem;
        line-height: 1.6;
        resize: none;
        outline: none;
        padding: 0;
    }
    .notes-editor:focus {
        background: rgba(255,255,255,0.02);
    }
    .save-notes-container {
        position: sticky;
        bottom: 0;
        background: var(--surface-color);
        padding: 1rem 0;
        border-top: 1px solid var(--border-color);
        margin-top: auto;
    }
    .save-status {
        font-size: 0.8rem;
        margin-top: 0.5rem;
        transition: opacity 0.3s;
        height: 1.2rem;
        color: var(--text-color);
        opacity: 0.7;
    }
    .sidebar-toolbar {
        flex-wrap: wrap;
        gap: 0.25rem;
    }
    .sidebar-toolbar .toolbar-group {
        gap: 0.15rem;
    }
    .sidebar-toolbar .toolbar-btn {
        padding: 0.25rem 0.4rem;
    }
    .no-transition {
        transition: none !important;
    }

    /* Responsive Adjustments */
    @media (max-width: 1200px) {
        .toc-sidebar { width: 250px; }
        .notes-sidebar { width: var(--notes-sidebar-width, 300px); }
    }

    @media (max-width: 992px) {
        .toc-sidebar, .notes-sidebar {
            position: fixed;
            z-index: 1000;
            height: 100vh;
            box-shadow: 10px 0 30px rgba(0,0,0,0.5);
        }
        .toc-sidebar { left: 0; }
        .notes-sidebar {
            right: 0;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }
        .toc-sidebar.collapsed { transform: translateX(-100%); width: 300px; }
        .notes-sidebar.collapsed { transform: translateX(100%); width: 350px; }

        /* Overlays when open */
        .book-layout::after {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 900;
            display: none;
            backdrop-filter: blur(2px);
        }
    }

    /* Smooth Fade-in Animation */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .book-content {
        animation: fadeIn 0.4s ease-out;
    }
</style>
<script>
    async function toggleShare() {
        const isShared = document.getElementById('shareToggle').checked;
        const notesShareContainer = document.getElementById('notesShareContainer');

        try {
            const res = await fetch('/library/{{ book.id }}/toggle-share', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                    'X-JWE-Token': document.querySelector('meta[name="jwe-token"]').getAttribute('content')
                },
                body: JSON.stringify({is_shared: isShared})
            });
            if(!res.ok) throw new Error("Share toggle failed");

            // Show/hide notes share toggle dynamically
            if (isShared) {
                notesShareContainer.style.display = 'block';
            } else {
                notesShareContainer.style.display = 'none';
                // Also uncheck the notes toggle when hiding
                document.getElementById('notesShareToggle').checked = false;
            }
        } catch (e) {
            alert("Failed to update status.");
            document.getElementById('shareToggle').checked = !isShared;
        }
    }

    async function toggleNotesShare() {
        const notesShared = document.getElementById('notesShareToggle').checked;
        try {
            const res = await fetch('/library/{{ book.id }}/toggle-notes-share', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                    'X-JWE-Token': document.querySelector('meta[name="jwe-token"]').getAttribute('content')
                },
                body: JSON.stringify({notes_shared: notesShared})
            });
            if(!res.ok) throw new Error("Notes share toggle failed");
        } catch (e) {
            alert("Failed to update notes sharing status.");
            document.getElementById('notesShareToggle').checked = !notesShared;
        }
    }

    function toggleNotes() {
        const sidebar = document.getElementById('notesSidebar');
        sidebar.classList.toggle('collapsed');
        const isCollapsed = sidebar.classList.contains('collapsed');
        localStorage.setItem('book-notes-collapsed', isCollapsed);

        const btn = document.getElementById('toggleNotesBtn');
        if (isCollapsed) {
            btn.innerHTML = '<i class="fas fa-book-open me-2"></i> Show Notes';
        } else {
            btn.innerHTML = '<i class="fas fa-book me-2"></i> Hide Notes';
        }
    }
    function toggleTOC() {
        const sidebar = document.getElementById('tocSidebar');
        sidebar.classList.toggle('collapsed');
        const isCollapsed = sidebar.classList.contains('collapsed');
        localStorage.setItem('book-toc-collapsed', isCollapsed);

        const btn = document.getElementById('toggleTOCBtn');
        if (isCollapsed) {
            btn.innerHTML = '<i class="fas fa-list-ul me-2"></i> Show Content';
        } else {
            btn.innerHTML = '<i class="fas fa-list-ul me-2"></i> Hide Content';
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        // Sync button text states with the already-applied (above) classes
        if (localStorage.getItem('book-toc-collapsed') === 'true') {
            const btn = document.getElementById('toggleTOCBtn');
            if (btn) btn.innerHTML = '<i class="fas fa-list-ul me-2"></i> Show Content';
        }
        if (localStorage.getItem('book-notes-collapsed') === 'true') {
            const btn = document.getElementById('toggleNotesBtn');
            if (btn) btn.innerHTML = '<i class="fas fa-book-open me-2"></i> Show Notes';
        }

        // Remove no-transition after initial render
        setTimeout(() => {
            document.getElementById('tocSidebar').classList.remove('no-transition');
            const notes = document.getElementById('notesSidebar');
            if (notes) notes.classList.remove('no-transition');
        }, 100);
        // Initialize Rich Notes
        {% if current_page_data %}
        if (typeof initNotes === 'function') {
            initNotes({
                topicName: "{{ current_page_data.topic.name }}",
                csrfToken: document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                jweToken: document.querySelector('meta[name="jwe-token"]').getAttribute('content'),
                readOnly: {% if notes_are_shared %}true{% else %}false{% endif %}
            });
        }
        {% endif %}

        // Resizer Logic
        const sidebar = document.getElementById('notesSidebar');
        const resizer = document.getElementById('sidebarResizer');
        if (sidebar && resizer) {
            let startX, startWidth;

            resizer.addEventListener('mousedown', (e) => {
                startX = e.clientX;
                startWidth = sidebar.offsetWidth;
                document.body.classList.add('resizing');
                resizer.classList.add('resizing');
                sidebar.style.transition = 'none';

                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
            });

            function handleMouseMove(e) {
                const deltaX = startX - e.clientX;
                const newWidth = Math.min(Math.max(200, startWidth + deltaX), 800);
                document.documentElement.style.setProperty('--notes-sidebar-width', newWidth + 'px');
                localStorage.setItem('book-notes-width', newWidth);
            }

            function handleMouseUp() {
                document.body.classList.remove('resizing');
                resizer.classList.remove('resizing');
                sidebar.style.transition = 'width 0.3s ease, padding 0.3s ease';
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
            }
        }
    });

</script>
<style>
    body.resizing {
        cursor: col-resize;
        user-select: none;
    }
</style>
<link rel="stylesheet" href="{{ url_for('static', filename='notes.css') }}">
<script src="{{ url_for('static', filename='notes.js') }}"></script>
{% endblock %}

{% block content %}
<div class="book-layout">
    <div class="toc-sidebar no-transition" id="tocSidebar">
        <script>
            // Apply state instantly before browser renders content to prevent flash
            if (localStorage.getItem('book-toc-collapsed') === 'true') {
                document.getElementById('tocSidebar').classList.add('collapsed');
            }
        </script>
        <a href="{{ url_for('library.dashboard') }}" class="text-decoration-none text-secondary mb-4">
            <i class="fas fa-arrow-left me-2"></i> Back to Library
        </a>
        <h4 class="mb-2"><i class="fas fa-list-ul me-2"></i> Table of Contents</h4>
        <hr class="border-secondary mt-0 mb-2">

        {% set ns = namespace(current_topic=None) %}
        {% for page in all_pages %}
            {% if ns.current_topic != page.topic.name %}
                <div class="toc-topic mt-4">
                    <i class="fas fa-bookmark"></i> Ch. {{ page.topic_number }}: {{ page.topic.name }}
                </div>
                {% set ns.current_topic = page.topic.name %}
            {% endif %}
            <a href="{{ url_for('library.read_book', book_id=book.id, page_num=page.global_page) }}"
               class="toc-item {% if page.global_page == page_num %}active{% endif %}">
                {% if page.type == 'content' %}
                    {{ page.chapter.title }}
                {% else %}
                    <!-- Placeholder handling in sidebar -->
                    <i>Topic Placeholder</i>
                {% endif %}
            </a>
        {% endfor %}
    </div>

    <div class="book-content">
        <div class="book-header">
            <div class="header-top">
                <div style="flex: 1;">
                    {% if current_page_data %}
                        <div class="topic-indicator">Topic {{ current_page_data.topic_number }}: {{ current_page_data.topic.name }}</div>
                    {% endif %}
                    <h1 class="book-title">{{ book.title }}</h1>
                </div>

                <div class="page-nav">
                    {% if page_num > 1 %}
                        <a href="{{ url_for('library.read_book', book_id=book.id, page_num=page_num-1) }}" class="btn btn-outline-secondary nav-btn"><i class="fas fa-chevron-left"></i></a>
                    {% else %}
                        <button class="btn btn-outline-secondary nav-btn" disabled><i class="fas fa-chevron-left"></i></button>
                    {% endif %}

                    <div class="nav-stats">
                        {{ page_num }} / {{ total_pages }}
                    </div>

                    {% if page_num < total_pages %}
                        <a href="{{ url_for('library.read_book', book_id=book.id, page_num=page_num+1) }}" class="btn btn-outline-secondary nav-btn"><i class="fas fa-chevron-right"></i></a>
                    {% else %}
                        <button class="btn btn-outline-secondary nav-btn" disabled><i class="fas fa-chevron-right"></i></button>
                    {% endif %}
                </div>
            </div>

            <div class="header-bottom">
                <div class="toolbar">
                    <button id="toggleTOCBtn" class="btn btn-sm btn-outline-primary" onclick="toggleTOC()">
                        <i class="fas fa-list-ul me-2"></i> Hide Content
                    </button>

                    <button id="toggleNotesBtn" class="btn btn-sm btn-outline-secondary" onclick="toggleNotes()">
                        <i class="fas fa-book me-2"></i> Hide Notes
                    </button>

                    {% if book.user_id == current_user.userid %}
                    <a href="{{ url_for('library.edit_book', book_id=book.id) }}" class="btn btn-sm btn-outline-warning">
                        <i class="fas fa-edit me-2"></i> Edit Book
                    </a>
                    {% endif %}
                </div>

                <div class="toolbar">
                    {% if book.user_id == current_user.userid %}
                        <label style="cursor: pointer;">
                            <input type="checkbox" id="shareToggle" onchange="toggleShare()" {% if book.is_shared %}checked{% endif %} style="display: none;">
                            <div class="premium-switch">
                                <span class="switch-label">Share with Community</span>
                                <div class="switch-track"></div>
                            </div>
                        </label>

                        <label id="notesShareContainer" style="cursor: pointer; display: {% if book.is_shared %}block{% else %}none{% endif %};">
                            <input type="checkbox" id="notesShareToggle" onchange="toggleNotesShare()" {% if book.notes_shared %}checked{% endif %} style="display: none;">
                            <div class="premium-switch">
                                <span class="switch-label">Share Notes</span>
                                <div class="switch-track"></div>
                            </div>
                        </label>
                    {% endif %}
                </div>
            </div>
        </div>

        {% if current_page_data %}
            {% if current_page_data.type == 'placeholder' %}
                <div class="text-center mt-5">
                    <h4>This topic hasn't been started yet.</h4>
                    <p>To generate the content for this chapter, open the topic from your main Dashboard.</p>
                    <a href="{{ url_for('chapter.mode', topic_name=current_page_data.topic.name) }}" class="btn btn-primary mt-3">Open Topic in Interactive Mode</a>
                </div>
            {% else %}
                <h3 class="mb-4">{{ current_page_data.chapter.title }}</h3>
                <div class="fs-5 markdown-content" style="line-height: 1.8;">
                    {{ current_page_data.chapter_html | safe }}
                </div>
            {% endif %}
        {% else %}
            <div class="text-center mt-5">
                <h4>This book is empty.</h4>
            </div>
        {% endif %}

        <div class="book-footer">
            <div class="page-nav">
                {% if page_num > 1 %}
                    <a href="{{ url_for('library.read_book', book_id=book.id, page_num=page_num-1) }}" class="btn btn-outline-secondary nav-btn">
                        <i class="fas fa-chevron-left me-2"></i> Previous
                    </a>
                {% else %}
                    <button class="btn btn-outline-secondary nav-btn" disabled>
                        <i class="fas fa-chevron-left me-2"></i> Previous
                    </button>
                {% endif %}

                <div class="nav-stats">
                    Page {{ page_num }} / {{ total_pages }}
                </div>

                {% if page_num < total_pages %}
                    <a href="{{ url_for('library.read_book', book_id=book.id, page_num=page_num+1) }}" class="btn btn-outline-secondary nav-btn">
                        Next <i class="fas fa-chevron-right ms-2"></i>
                    </a>
                {% else %}
                    <button class="btn btn-outline-secondary nav-btn" disabled>
                        Next <i class="fas fa-chevron-right ms-2"></i>
                    </button>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="notes-sidebar no-transition" id="notesSidebar">
        <div class="resizer" id="sidebarResizer"></div>
        <script>
            if (localStorage.getItem('book-notes-collapsed') === 'true') {
                document.getElementById('notesSidebar').classList.add('collapsed');
            }
            const savedWidth = localStorage.getItem('book-notes-width');
            if (savedWidth) {
                document.documentElement.style.setProperty('--notes-sidebar-width', savedWidth + 'px');
            }
        </script>
        <h4>{% if notes_are_shared %}Owner's Notes{% else %}Notebook{% endif %}</h4>
        <hr class="border-secondary">
        {% if show_notes %}
            {% if current_page_data %}
                {% if notes_are_shared %}
                    <div class="alert alert-info" style="margin: 0 1rem 1rem 1rem; padding: 0.5rem 0.75rem; font-size: 0.85rem; background: rgba(137, 180, 250, 0.1); border: 1px solid rgba(137, 180, 250, 0.3); border-radius: 6px;">
                        <i class="fas fa-info-circle me-2"></i>Shared by {{ owner_name }}
                    </div>
                {% endif %}

                <div class="notes-sidebar-content p-0" style="display: flex; flex-direction: column; flex-grow: 1;">
                    {% if not notes_are_shared %}
                    <div class="toolbar sidebar-toolbar mb-3 px-1">
                        <div class="toolbar-group">
                            <button class="toolbar-btn" data-command="bold" title="Bold"><i class="fas fa-bold"></i></button>
                            <button class="toolbar-btn" data-command="italic" title="Italic"><i class="fas fa-italic"></i></button>
                            <button class="toolbar-btn" data-command="underline" title="Underline"><i class="fas fa-underline"></i></button>
                            <button class="toolbar-btn" data-command="strikeThrough" title="Strikethrough"><i class="fas fa-strikethrough"></i></button>
                        </div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List"><i class="fas fa-list-ul"></i></button>
                            <button class="toolbar-btn" data-command="insertOrderedList" title="Numbered List"><i class="fas fa-list-ol"></i></button>
                        </div>
                        <div class="toolbar-group">
                            <select id="font-select" class="form-select form-select-sm font-select" title="Font Family" style="width: auto; background: transparent; border: 1px solid rgba(255,255,255,0.1); color: inherit;">
                                <option value="Font" disabled>Font</option>
                                <option value="Inter, sans-serif" selected>Sans Serif</option>
                                <option value="'Courier New', Courier, monospace">Monospace</option>
                                <option value="'Times New Roman', Times, serif">Serif</option>
                                <option value="'Dancing Script', cursive">Handwriting</option>
                            </select>
                        </div>
                    </div>
                    {% endif %}

                    <div id="notes-editor" class="notes-editor" contenteditable="{% if notes_are_shared %}false{% else %}true{% endif %}" placeholder="{% if notes_are_shared %}{% else %}Start typing your notes...{% endif %}" style="flex-grow: 1; overflow-y: auto; {% if notes_are_shared %}background: rgba(137, 180, 250, 0.03); cursor: default;{% endif %}">
                        {{ current_page_data.topic.notes | safe }}
                    </div>

                    {% if not notes_are_shared %}
                    <div class="notes-sidebar-footer text-center mt-3 pt-2" style="border-top: 1px solid rgba(255,255,255,0.05);">
                        <span id="save-status" class="save-status">Saved</span>
                    </div>
                    {% endif %}
                </div>
            {% else %}
                <p class="text-muted text-center mt-4">Empty topic.</p>
            {% endif %}
        {% else %}
            <div class="d-flex flex-column align-items-center text-center mt-5 text-muted" style="padding: 0 2rem; width: 100%; box-sizing: border-box;">
                <i class="fas fa-lock mb-3 fs-2"></i>
                <p class="mb-0">Private notes are hidden when viewing community books.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
