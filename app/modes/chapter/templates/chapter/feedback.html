{% extends "base.html" %}

{% block title %}Feedback on Your Answer{% endblock %}

{% block content %}
<h1>Feedback for {{ topic.name }}</h1>
<div class="feedback-content">
    <h2>Your Score: {{ "%.2f"|format(score) }}%</h2>
    {% for result in feedback_results %}
    <div class="feedback-card {{ 'is-correct' if result.is_correct else 'is-incorrect' }}">
        <div class="feedback-header">
            <div class="feedback-status-icon">
                {% if result.is_correct %}
                <svg viewBox="0 0 24 24" class="icon-svg">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                </svg>
                {% else %}
                <svg viewBox="0 0 24 24" class="icon-svg">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                </svg>
                {% endif %}
            </div>
            <h3 class="feedback-question">{{ result.question }}</h3>
        </div>
        <div class="feedback-details">
            <div class="feedback-row user-answer">
                <span class="label">Your Answer:</span>
                <span class="value">{{ result.user_answer }}</span>
            </div>

            {% if not result.is_correct %}
            <div class="feedback-row correct-answer">
                <span class="label">Correct Answer:</span>
                <span class="value">{{ result.correct_answer }}</span>
            </div>
            {% endif %}

            <div class="feedback-row explanation">
                <span class="label">Analysis:</span>
                <span class="value">{{ result.feedback }}</span>
                {% if result.explanation %}
                <p style="margin-top: 10px; font-style: italic;">{{ result.explanation }}</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="navigation">
    {% if next_step_index < total_steps %} <a
        href="{{ url_for('chapter.learn_topic', topic_name=topic.name, step_index=next_step_index) }}" class="button"
        onclick="showLoader()">Continue to Next Step</a>
        {% else %}
        <a href="{{ url_for('chapter.complete_topic', topic_name=topic.name) }}" class="button">Finish Learning</a>
        {% endif %}
</div>
{% endblock %}
